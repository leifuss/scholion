<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Corpus Collections</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:      #111;
  --panel:   #1a1a1a;
  --border:  #2e2e2e;
  --text:    #d8d8d8;
  --muted:   #666;
  --accent:  #0071e3;
  --link:    #5ba3f5;
}

body {
  font-family: system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* ── Header ── */
header {
  background: #0a0a0a;
  border-bottom: 1px solid var(--border);
  padding: 14px 24px;
  display: flex;
  align-items: center;
  gap: 20px;
  flex-shrink: 0;
}
header h1 { font-size: 16px; font-weight: 600; color: #fff; }
header .sub { font-size: 12px; color: var(--muted); flex: 1; }

/* ── Main content ── */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 60px 24px 40px;
}

.main h2 {
  font-size: 22px;
  font-weight: 600;
  color: #fff;
  margin-bottom: 8px;
}

.main .intro {
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 36px;
  text-align: center;
  max-width: 520px;
  line-height: 1.6;
}

/* ── Collection cards grid ── */
.collection-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 16px;
  width: 100%;
  max-width: 900px;
}

.collection-card {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 24px 28px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  transition: border-color .2s, transform .15s, box-shadow .2s;
  cursor: pointer;
  text-decoration: none;
  color: inherit;
}
.collection-card:hover {
  border-color: var(--accent);
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0,0,0,.3);
  text-decoration: none;
  color: inherit;
}

.collection-card .card-name {
  font-size: 17px;
  font-weight: 600;
  color: #fff;
}
.collection-card .card-desc {
  font-size: 13px;
  color: var(--muted);
  line-height: 1.5;
}
.collection-card .card-meta {
  font-size: 11px;
  color: #555;
  margin-top: 4px;
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}
.collection-card .card-badges {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-top: 2px;
}
.collection-card .badge {
  font-size: 10px;
  padding: 2px 8px;
  border-radius: 10px;
  white-space: nowrap;
}
.b-items   { background: #1a2a3a; color: #5a9fd4; border: 1px solid #1a4a6a; }
.b-status  { background: #1a3a1a; color: #5fba7d; border: 1px solid #2a5a2a; }
.b-pending { background: #2a2000; color: #d4b05a; border: 1px solid #4a3800; }
.b-source  { background: #222;    color: #999;    border: 1px solid #333; }
.collection-card .card-arrow {
  font-size: 12px;
  color: var(--accent);
  margin-top: auto;
  padding-top: 8px;
}

/* ── Loading / error ── */
.loading-msg {
  text-align: center;
  padding: 60px 24px;
  color: var(--muted);
  font-size: 14px;
}

/* ── Scrollbars ── */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
</style>
</head>
<body>

<header>
  <h1>Corpus Collections</h1>
  <span class="sub" id="subtitle">Loading collections&hellip;</span>
</header>

<div class="main">
  <h2>Choose a Collection</h2>
  <p class="intro">Select a collection to explore its documents, timeline, map, and full-text reader.</p>
  <div class="collection-grid" id="grid">
    <p class="loading-msg">Loading collections&hellip;</p>
  </div>
</div>

<script>
function esc(s) {
  return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

fetch('collections.json')
  .then(r => { if (!r.ok) throw new Error(r.status); return r.json(); })
  .then(data => {
    const collections = data.collections || [];
    const grid = document.getElementById('grid');
    document.getElementById('subtitle').textContent =
      collections.length + ' collection' + (collections.length !== 1 ? 's' : '') + ' available';

    if (!collections.length) {
      grid.innerHTML = '<p class="loading-msg">No collections found in collections.json.</p>';
      return;
    }

    // If there is only one collection, redirect directly to explore
    if (collections.length === 1) {
      const c = collections[0];
      // Still show the landing page but auto-navigate is optional;
      // let the user see the card and click through.
    }

    grid.innerHTML = collections.map(c => {
      const href = `explore.html?collection=${encodeURIComponent(c.slug)}`;
      const src = c.source || {};
      const srcLabel = src.library_type === 'group'
        ? `group ${src.library_id}` : src.library_type === 'user' ? 'personal library' : '';
      const itemCount = c.num_items ? `${c.num_items} items` : '';
      const statusMap = {
        pending: ['Pending', 'b-pending'],
        synced:  ['Synced', 'b-status'],
        built:   ['Dashboard ready', 'b-status'],
        readers_ready: ['Readers ready', 'b-status'],
      };
      const [statusLabel, statusCls] = statusMap[c.status] || ['', ''];
      const builtAt = c.built_at ? `Built ${c.built_at.slice(0,10)}` : '';

      return `<a class="collection-card" href="${esc(href)}">
        <div class="card-name">${esc(c.name)}</div>
        <div class="card-desc">${esc(c.description || '')}</div>
        <div class="card-badges">
          ${itemCount ? `<span class="badge b-items">${esc(itemCount)}</span>` : ''}
          ${statusLabel ? `<span class="badge ${statusCls}">${esc(statusLabel)}</span>` : ''}
          ${srcLabel ? `<span class="badge b-source">${esc(srcLabel)}</span>` : ''}
        </div>
        <div class="card-meta">
          ${builtAt ? `<span>${esc(builtAt)}</span>` : ''}
        </div>
        <div class="card-arrow">Open collection &rarr;</div>
      </a>`;
    }).join('');
  })
  .catch(err => {
    document.getElementById('grid').innerHTML =
      `<p class="loading-msg">Failed to load collections.json: ${esc(err.message)}</p>`;
  });
</script>
</body>
</html>
